<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>University of Colorado Levothyroxine Dose Calculator</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
{#    <link rel="stylesheet" href="/static/bootstrap-4.1.3-dist/css/bootstrap.min.css">#}
{#    <script src="static/bootstrap-4.1.3-dist/js/bootstrap.min.js "></script>#}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>

<body>

    <div class="text-center">
        <h1>Levothyroxine Dose Calculator</h1>
        <p>This calculator estimates starting levothyroxine dose for patients undergoing thyroidectomy</p>
        <p>Linear regression model trained on retrospective data collected at the University of Colorado </p>
        <p style="color:red">This calculator was not prospectively validated and not FDA approved for clinical use </p>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <div class="container">
                    <form id = "calculator", name="calculator_form" action="" class="form-inline" method="post" onsubmit="return false"
                      style="width: 450px; padding: 1em; border: 1px solid #CCC; border-radius: 1em;">

                        <h3>1. Select Gender</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li>
                                <input type="radio" id="female" name="gender" value="female">
                                <label for="female"> Female</label><br>
                            </li>
                            <li>
                                <input type="radio" id="male" name="gender" value="male">
                                <label for="male"> Male</label><br>
                            </li>
                        </ul>

                        <h3>2. Enter Weight, Height and Age</h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li>
                                <label style="display:inline-block; width: 90px; text-align: right;" for="height">Height, cm:</label>
                                <input type="number" step="0.01" id="height" name="height"><br>
                            </li>
                            <li>
                                <label style="display:inline-block; width: 90px; text-align: right;" for="weight"> Weight, kg:</label>
                                <input type="number" step="0.01" id="weight" name="weight"><br>
                            </li>
                            <li>
                                <label style="display:inline-block; width: 90px; text-align: right;" for="age"> Age:</label>
                                <input type="number" step="0.01" id="age" name="v"><br>
                            </li>
                        </ul>

                        <h3>3. Confirm Inclusion Criteria </h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li>
                                <input type="checkbox" id="nopreg" name="nopreg" value="not_pregnant">
                                <label for="nopreg"> Patient not pregnant</label>
                            </li>
                            <li>
                                <input type="checkbox" id="nothyroid" name="nothyroid" value="not_on_thyroid_hormone">
                                <label for="nothyroid"> Patient was not taking thyroid hormones before surgery</label><br>
                            </li>
            {#                <li>#}
            {#                    <input type="checkbox" id="nothyper" name="nohypercb" value="not_hyperthyroid">#}
            {#                    <label for="nothyper"> If patient is hyperthyroid, preoperative TSH is > 0.05  </label>#}
            {#                </li>#}
                        </ul>

                        <h3>4. Check if patient takes calcium supplement </h3>
                        <input type="checkbox" id="calcium" name="calcium" value="on_calcium">
                        <label for="calcium"> Calcium supplements  </label>


                        <h3>5. Select target TSH </h3>

                        <div class="btn-group-vertical">
                            <input id="benign_btn" class="btn btn-success" type="submit" value="Benign. TSH target 2.5 uIU">
                            <input id="low_btn" class="btn btn-success" type="submit" value="Low risk cancer. TSH target 1.25 uIU">
                            <input id="intermediate_btn" class="btn btn-success" type="submit" value="Intermediate risk cancer. TSH target 0.3 uIU">
                            <input id="high_btn" class="btn btn-success" type="submit" value="High risk cancer. TSH target 0.1 uIU">
                        </div>

                        <br>
                        <br>
                        <label style="display:inline-block; width: 110px; text-align: right;" for="tsh">TSH target, uIU:</label>
                        <input type="number" step="0.01" id="tsh" name="tsh"><br>
                    </form>



                </div>
            </div>

            <div class="col-sm-6" style="width: 450px; padding: 1em; border: 1px solid #CCC; border-radius: 1em;">
                <div class="container" style="width: 420px">
                    <br>
                    <br>
                    <input id="calculate_btn" class="btn btn-primary btn-lg" type="submit" value="CALCULATE LEVOTHYROXINE DOSE">
                    <br>
                    <br>
                </div>
                <div class="container" style="width: 420px">
                    <div class="jumbotron", style="text-align: center;">
                        <h3>Calculated Dose</h3>
                        <h3 id="calcdose" style="color:blue; font-weight: bold"></h3>
                        <br>
                        <h3>Recommended Dose</h3>
                        <h3 id="recdose" style="color:red; font-weight: bold"></h3>
                    </div>

                </div>
            </div>

        </div>
    </div>


    <script>

        // TSH target buttons
        $(document).ready(function(){

            $("#benign_btn").on("click", function(){
                $("#tsh").val(2.5);
            });
            $("#low_btn").on("click", function(){
                $("#tsh").val(1.25);
            });
            $("#intermediate_btn").on("click", function(){
                $("#tsh").val(0.3);
            });
            $("#high_btn").on("click", function(){
                $("#tsh").val(0.1);
            });

            // checks no pregnancy inclusion criteria if male
            $("input[name='gender']").change(function(){
                var gender = $("input[name='gender']:checked","#calculator").val();
                if (gender == 'male') {
                    $( "#nopreg" ).prop( "checked", true );
                } else {
                    $( "#nopreg" ).prop( "checked", false );
                }
            });


        // Logic when Calculate button is hit
        $("#calculate_btn").on("click", function(){

            // checking inputs
            // Gender
            var gender = $("input[name='gender']:checked","#calculator").val();
            var gender_index;
            if ((gender != 'male') && (gender != 'female')){
                alert("Please select gender");
                return false;
            } else {
                if(gender == 'male'){
                    gender_index = 1;
                } else {
                    gender_index = 0;
                }
            }

            // Height
            var height =$("#height").val();
            if (height.length == 0){
                alert("Please enter height in cm");
                return false;
            } else {
                if (height < 142){
                alert("Height is too low. Select value between 142 and 200 cm");
                return false;
                } else {
                    if (height > 200){
                    alert("Height is too high. Select value between 142 and 200 cm");
                    return false;
                    }
                }
            }

            // Weight
            var weight =$("#weight").val();
            if (weight.length == 0){
                alert("Please enter weight in kg");
                return false;
            } else {
                if (weight < 41){
                alert("Weight is too low. Select value between 41 and 170 kg");
                return false;
                } else {
                    if (weight > 170){
                    alert("Weight is too high. Select value between 41 and 170 kg");
                    return false;
                    }
                }
            }

            // Age
            var age =$("#age").val();
            if (age.length == 0){
                alert("Please enter age in years");
                return false;
            } else {
                if (age < 18){
                alert("This calculator is designed for adults only. Please correct age");
                return false;
                } else {
                    if (age > 88){
                    alert("Age is too high. Select value between 18 and 88 years");
                    return false;
                    }
                }
            }

            // Inclusion checkboxes
            if(!($("#nopreg").is(":checked") && $("#nothyroid").is(":checked"))){
                alert("Please confirm that Inclusion Cariteria are met");
                return false;
            };

            // TSH Target
            var tsh =$("#tsh").val();
            if (tsh.length == 0){
                alert("Please select target TSH");
                return false;
            } else {
                if (tsh < 0.01 || tsh > 5){
                alert("TSH target should be between 0.01 and 5 uIU");
                return false;
                }
            };

            // reading calcium checkbox status
            var calcium;
            if($("#calcium").is(":checked")){
                calcium = 1;
            } else {
                calcium = 0;
            };

            // Calculating dose
            var LT4_predicted;
            LT4_predicted = 35.75551-3.04035*(Math.log(tsh)) + 1.35335*weight + 0.0444*(height-168.3793) + 5.87127*gender_index - 0.29526*age
                + 4.13099*calcium +0.23647*gender_index*(height-168.3793);

            //plotting calculated dose
            $("#calcdose").empty()
            $("#calcdose").append(Math.round(LT4_predicted) + ' mcg/day');

            //calculating and plotting recommended dose
            var LT4doses = [50, 75, 88, 100, 112, 125, 137, 150, 175, 200, 224, 250, 275, 300];
            var recommendedLT4 = LT4doses.reduce(function(prev, curr) {
                return (Math.abs(curr - LT4_predicted) < Math.abs(prev - LT4_predicted) ? curr : prev);
            });
            $("#recdose").empty()
            $("#recdose").append(Math.round(recommendedLT4) + ' mcg/day');
        });


    });
</script>

</body>
</html>